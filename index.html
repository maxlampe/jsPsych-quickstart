<!DOCTYPE html>
<html>
<head>
    <title>Paced Mentats: Expert Data Annotation</title>
    <script src="jspsych/jspsych.js"></script>
    <script src="./questions.js"></script>
    <script src="jspsych/plugin-html-keyboard-response.js"></script>
    <script src="plugin-survey-slider.js"></script>
    <link href="jspsych/jspsych.css" rel="stylesheet" type="text/css" />
</head>
<body></body>
<script>

    var questions = [
        {
            "q_no": "1",
            "question": "What is the largest planet in our solar system?",
            "choice1": "Earth",
            "choice2": "Jupiter",
            "choice3": "Saturn",
            "choice4": "Mars"
        },
        {
            "q_no": "2",
            "question": "What is the boiling point of water?",
            "choice1": "90째C",
            "choice2": "100째C",
            "choice3": "110째C",
            "choice4": "120째C"
        },
        {
            "q_no": "3",
            "question": "Who wrote 'Romeo and Juliet'?",
            "choice1": "Mark Twain",
            "choice2": "Charles Dickens",
            "choice3": "William Shakespeare",
            "choice4": "Jane Austen"
        },
    ];

    var jsPsych = initJsPsych({
        on_finish: function () {
            jsPsych.data.get().localSave('csv','annotation_data.csv');
        },
        show_progress_bar: true,
    });

    var timeline = [];

    const welcome = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: 'Welcome to the data annotation process. Press any key to begin.'
    };
    timeline.push(welcome);

    const participantInfo = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
            <p>Please enter your first name:</p>
            <input type="text" id="participant-name" name="participant-name">
            <p>Please enter your given unique rater ID (UID):</p>
            <input type="text" id="rater-id" name="rater-id">
            <button onclick="jsPsych.finishTrial({ 
                participant_name: document.getElementById('participant-name').value, 
                rater_id: document.getElementById('rater-id').value 
            })">Submit</button>
        `,
        choices: "NO_KEYS",
        on_load: function() {
            document.querySelector('button').addEventListener('click', function() {
                jsPsych.finishTrial({
                    participant_name: document.getElementById('participant-name').value,
                    rater_id: document.getElementById('rater-id').value
                });
            });
        }
    };
    timeline.push(participantInfo);

    function createSurvey(questionData) {
        function getRandomSliderStart() {
            return Math.floor(Math.random() * 101); // Generates a random integer between 0 and 100
        }

        return {
            type: jsPsychSurveySlider,
            preamble: "<p>" + questionData.question + "</p>", 
            questions: [
                {prompt: questionData.choice1, ticks:['0','100'], slider_start: getRandomSliderStart()},
                {prompt: questionData.choice2, ticks:['0','100'], slider_start: getRandomSliderStart()},
                {prompt: questionData.choice3, ticks:['0','100'], slider_start: getRandomSliderStart()},
                {prompt: questionData.choice4, ticks:['0','100'], slider_start: getRandomSliderStart()},
            ],
            post_trial_gap: 1000,
            randomize_question_order: true,
            require_movement: true,
            slider_width: 200,
            data: { q_no: questionData.q_no, q: questionData.question }, 
        };
    }

    var sampledQuestions = questions.sort(() => 0.5 - Math.random()).slice(0, 3);

    sampledQuestions.forEach(function(question) {
        var survey = createSurvey(question);
        timeline.push(survey);
    });

    jsPsych.run(timeline);

</script>
</html>
